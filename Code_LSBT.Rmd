---
title: "Code: LSBT"
author: "Debora Elías Díaz"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output: html_document
---




```{r setup, include=FALSE}
set.seed(888)
library(knitr)
knitr::opts_chunk$set(echo = TRUE, out.width = '100%', 
                      cache = FALSE, message = FALSE)
```


## *Quantile Regression - Comments:*
<div class=text-justify> 1) For quantile regression, We provide the code to graph each of the statistically significant quantiles along the data distribution.
<div class=text-justify> 2) Data information were obtained: 
<div class=text-justify> - Length of fruit for each plant species. Resource: Tropicos (https://www.tropicos.org) 
<div class=text-justify> - Length of forearm of bat species. Resource: Handbook of the Mammals of the World. We used the midpoint of forearm size. Reference (Solari, S., Medellín, R., Rodríguez-Herrera, B., Dumont, E., & Burneo, S. (2019). Family Phyllostomidae (New World Leaf-Nosed Bats). Pp. 444-583. In: Wilson, D. E., & Mittermeier, R. A. (Eds.). (2019). Handbook of the Mammals of the World: Volume 9: Bats (Vol. 9). Lynx Edicions, Barcelona.)




```{r, warning=FALSE, message=FALSE}
library(quantreg)
library(SparseM)
library(ggplot2)
library(ggpubr)
library(car)
library(lmtest)
library(jtools)
```



Load Data
```{r}
DR <- read.csv("./Quantile_Regression.csv", head=T, sep = ";")

head(DR)
```



```{r}
# quantile: 0.1
m01 <- rq(formula = Lfru ~ ABH, tau = 0.1,
                 data = DR)

summ(m01, 
     scale = FALSE,
  confint = getOption("summ-confint", FALSE),
  ci.width = getOption("summ-ci.width", 0.95),
  se = ("boot"),
  boot.sims = 10000,
  digits = 6)


summary(m01, se = "boot")



# Result: quantile 0.1; p < 0.05
```



```{r}
# Predict value

ABH_1 <- data.frame(ABH = seq(min(DR$ABH), max(DR$ABH), length.out = 100))

# Confidence interval
pred1 <- predict(m01, newdata = ABH_1, interval = "confidence", level = 0.95)

df_pred1 <- cbind(ABH_1, pred1)
colnames(df_pred1) <- c("ABH", "fit", "lwr", "upr")
```




```{r}
# Graph

G1 <- (ggplot() +
  geom_point(data = DR, aes(x = ABH, y = Lfru), alpha = 0.5, color = "#09622A", size = 2) +  
  geom_line(data = df_pred1, aes(x = ABH, y = fit), color = "#09622A", size = 1) +  
  geom_ribbon(data = df_pred1, aes(x = ABH, ymin = lwr, ymax = upr), alpha = 0.5, fill = "#6CA860") + 
  labs(title = "",
       x = "Length of Forearm mm (FA)",
       y = "Length of Fruit mm (LF)") +
      scale_x_continuous(limits = c(33, 65), breaks = seq(33, 65, by = 5)) +
  theme_classic())

G1
```





```{r}
# quantile: 0.15
m02 <- rq(formula = Lfru ~ ABH, tau = 0.15,
                 data = DR)

summ(m02, 
     scale = FALSE,
  confint = getOption("summ-confint", FALSE),
  ci.width = getOption("summ-ci.width", 0.95),
  se = ("boot"),
  boot.sims = 10000,
  digits = 6)


summary(m02)



# Result: quantile 0.15; p > 0.05
```




```{r}
# quantile: 0.2
m03 <- rq(formula = Lfru ~ ABH, tau = 0.2,
                 data = DR)

summ(m03, 
     scale = FALSE,
  confint = getOption("summ-confint", FALSE),
  ci.width = getOption("summ-ci.width", 0.95),
  se = ("boot"),
  boot.sims = 10000,
  digits = 6)


summary(m03)


# Result: quantile 0.2; p > 0.05
```





```{r}
# quantile: 0.5
m04 <- rq(formula = Lfru ~ ABH, tau = 0.5,
                 data = DR)

summ(m04, 
     scale = FALSE,
  confint = getOption("summ-confint", FALSE),
  ci.width = getOption("summ-ci.width", 0.95),
  se = ("boot"),
  boot.sims = 10000,
  digits = 6)


summary(m04)



# Result: quantile 0.5; p > 0.05
```





```{r}
# Predict value
ABH_2 <- data.frame(ABH = seq(min(DR$ABH), max(DR$ABH), length.out = 100))

# Confidence interval
pred2 <- predict(m04, newdata = ABH_2, interval = "confidence", level = 0.95)

df_pred2 <- cbind(ABH_2, pred2)
colnames(df_pred2) <- c("ABH", "fit", "lwr", "upr")
```




```{r}
# Graph 

G2 <- (ggplot() +
  geom_point(data = DR, aes(x = ABH, y = Lfru), alpha = 0.5, color = "#09622A", size = 2) +  
  geom_line(data = df_pred3, aes(x = ABH, y = fit), color = "#09622A", size = 1) + 
  geom_ribbon(data = df_pred3, aes(x = ABH, ymin = lwr, ymax = upr), alpha = 0.5, fill = "#6CA860") +  
  labs(title = "",
       x = "Length of Forearm mm (FA)",
       y = "Length of Fruit mm (LF)") +
      scale_x_continuous(limits = c(33, 65), breaks = seq(33, 65, by = 5)) +
  theme_classic())

G2
```




```{r}
# quantile: 0.8
m05 <- rq(formula = Lfru ~ ABH, tau = 0.8,
                 data = DR)

summ(m05, 
     scale = FALSE,
  confint = getOption("summ-confint", FALSE),
  ci.width = getOption("summ-ci.width", 0.95),
  se = ("boot"),
  boot.sims = 10000,
  digits = 6)


summary(m05)


# Result: quantil 0.8; p > 0.05
```



```{r}
# quantile: 0.85
m06 <- rq(formula = Lfru ~ ABH, tau = 0.85,
                 data = DR)

summ(m06, 
     scale = FALSE,
  confint = getOption("summ-confint", FALSE),
  ci.width = getOption("summ-ci.width", 0.95),
  se = ("boot"),
  boot.sims = 10000,
  digits = 6)


summary(m06)



# Result: quantil 0.85; p < 0.05
```




```{r}
# Predict value
ABH_3 <- data.frame(ABH = seq(min(DR$ABH), max(DR$ABH), length.out = 100))

# Confidence interval
pred3 <- predict(m06, newdata = ABH_3, interval = "confidence", level = 0.95)


df_pred3 <- cbind(ABH_3, pred3)
colnames(df_pred3) <- c("ABH", "fit", "lwr", "upr")
```




```{r}
# Graph

G <- (ggplot() +
  geom_point(data = DR, aes(x = ABH, y = Lfru), alpha = 0.5, color = "#09622A", size = 2) +  
  geom_line(data = df_pred3, aes(x = ABH, y = fit), color = "#09622A", size = 1) +  
  geom_ribbon(data = df_pred3, aes(x = ABH, ymin = lwr, ymax = upr), alpha = 0.5, fill = "#6CA860") +  
  labs(title = "",
       x = "Length of Forearm mm (FA)",
       y = "Length of Fruit mm (LF)") +
       scale_x_continuous(limits = c(33, 65), breaks = seq(33, 65, by = 5)) +
  theme_classic())

G
```




```{r}
# quantile: 0.9
m07 <- rq(formula = Lfru ~ ABH, tau = 0.9,
                 data = DR)

summ(m07, 
     scale = FALSE,
  confint = getOption("summ-confint", FALSE),
  ci.width = getOption("summ-ci.width", 0.95),
  se = ("boot"),
  boot.sims = 10000,
  digits = 6)

summary(m07)
```




```{r}
# Predict value
ABH_4 <- data.frame(ABH = seq(min(DR$ABH), max(DR$ABH), length.out = 100))

# Confidence interval
pred_4 <- predict(m07, newdata = ABH_nuevo, interval = "confidence", level = 0.95)


df_pred_4 <- cbind(ABH_4, pred_4)
colnames(df_pred_4) <- c("ABH", "fit", "lwr", "upr")
```





```{r}
# Graph 

G1 <- (ggplot() +
  geom_point(data = DR, aes(x = ABH, y = Lfru), alpha = 0.5, color = "#09622A", size = 2) +  
  geom_line(data = df_pred, aes(x = ABH, y = fit), color = "#09622A", size = 1) +  
  geom_ribbon(data = df_pred, aes(x = ABH, ymin = lwr, ymax = upr), alpha = 0.5, fill = "#6CA860") +  
  labs(title = "",
       x = "Length of Forearm mm (FA)",
       y = "Length of Fruit mm (LF)") +
       scale_x_continuous(limits = c(33, 65), breaks = seq(33, 65, by = 5)) +
  theme_classic())

G1
```



## *Bipartite Network*

<div class=text-justify> Comments: We evaluated the stomatochorous dispersal network between tent-roosting bats and angiosperm in the Neotropics. 

Interaction Network 
```{r}
library(permute)
library(lattice)
library(vegan)
library(statnet.common)
library(network)
library(bipartite)
library(RColorBrewer)

```



Load data
```{r}
redbp <- read.csv("./Interaction_Network.csv", head=T, sep = ";")

head(redbp)
```



```{r}
web_matrix <- as.matrix(redbp[, -1])  # omit colum 1

# row names
rownames(web_matrix) <- redbp[, 1]

# Visualization
mod <- computeModules(web_matrix)
```


```{r}
# Graph 1

svg("graph_1.svg", width = 10, height = 10)

visweb(web_matrix, square="b",box.col="#1B4F72",box.border="black", plotsize = 3, labsize = 5, pred.lablength = 10, prey.lablength = 10)

dev.off()
```




```{r}
# Bipartite network 

svg("graph_2.svg", width = 10, height = 10)

plotweb(web_sorted, text.rot = 90, col.interaction =c("#878A72","#878A72","#346F1F", "#275317", "#0B3041","#878A72", "#878A72", "#F4E5C0"), col.high = c("#878A72","#878A72","#346F1F", "#275317", "#0B3041","#878A72", "#878A72", "#F4E5C0", bor.col.interaction = c("#878A72","#878A72","#346F1F", "#275317", "#0B3041","#878A72", "#878A72", "#F4E5C0"), bor.col.high=c("#878A72","#878A72","#346F1F", "#275317", "#0B3041","#878A72", "#878A72", "#F4E5C0")), labsize = 0.8, y.width.low=0.05, y.width.high=0.05, y.lim=c(-1,2.0))

dev.off()
```



```{r}
# Calculate network metric links per species for all 
networklevel(web_matrix)
```





```{r session, echo=FALSE}
Si <- sessionInfo()# Información de la sesión
print(Si)
```


























